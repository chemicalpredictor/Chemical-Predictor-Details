<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Інтерактивна таблиця — баланс реакції + вектори (fixed layout)</title>

<style>
  :root{ --accent:#2a9df4; --pos:#1e6ed1; --neg:#d13b3b; --border:#9aa; }
  /* Box sizing reset to avoid unexpected overflow */
  *, *::before, *::after { box-sizing: border-box; }

  body{background:#f6f9fc; margin:0; padding:0; font-family:Arial, sans-serif; color:#222;}
  /* Make chem-wrap responsive and not wider than viewport */
  .chem-wrap{
    max-width:1200px;
    width:calc(100% - 32px);
    margin:24px auto;
    background:#fff;
    padding:16px;
    border-radius:12px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
    overflow:hidden; /* hide accidental overflow */
  }

  .main-title{text-align:center; font-weight:700; font-size:24px; margin-bottom:16px; color:#1e6ed1;}

  .title{text-align:center; font-weight:700; margin-bottom:6px; font-size:20px;}
  .eq{ text-align:center; margin-bottom:12px; font-size:18px;}
  .formula-box{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; align-items:center; margin-bottom:8px;}
  .formula-part{display:inline-flex; align-items:center; gap:6px; font-weight:600;}

  .controls-row{display:flex; gap:12px; align-items:center; justify-content:center; margin-bottom:12px; flex-wrap:wrap;}

  /* layout: allow right column to shrink but not disappear, prevents overflow */
  .layout{
    display:grid;
    grid-template-columns: 1fr minmax(280px, 480px);
    gap:16px;
    align-items:start;
  }
  @media (max-width:1100px){ .layout{grid-template-columns:1fr;} }

  table.chem{border-collapse:collapse; width:100%;}
  table.chem caption{caption-side:top; font-weight:700; margin-bottom:8px; text-align:left;}
  table.chem th, table.chem td{border:1px solid var(--border); padding:6px; text-align:center; min-width:46px; background:#fff; vertical-align:middle;}
  table.chem th{background:#e6f0fb; font-weight:700;}
  .elem-cell{background:#fafafa; font-weight:600;}
  input.num{width:100%; border:0; text-align:center; font-size:14px; padding:4px; background:transparent;}
  input.num:focus{outline:1px solid var(--accent); background:#eef7ff;}
  .coef{width:48px; padding:4px; text-align:center; border-radius:6px; border:1px solid #d7eafb; background:#f8fbff;}
  .mol-header{display:flex; flex-direction:column; gap:6px; align-items:center; justify-content:center;}
  .mol-name{font-weight:700; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:80px;}
  .mol-coef-label{font-size:11px; color:#555;}
  .rp-cell{min-height:36px; min-width:64px; display:flex; align-items:center; justify-content:center; background:#fff; transition:color 0.15s, background 0.15s;}
  .rp-zero{color:#333;}
  .rp-pos{color:var(--pos); font-weight:700;}
  .rp-neg{color:var(--neg); font-weight:700;}
  .note{font-size:13px; color:#555; text-align:center; margin-top:8px;}
  .mol-fallback{opacity:0.7; font-style:italic;}
  .rp-header{ white-space:nowrap; vertical-align:middle; }

  /* vector panel: responsive; doesn't force width beyond container */
  .vector-panel{
    background:#fff;
    border:1px solid #e2eefc;
    border-radius:10px;
    padding:8px;
    max-width:100%;
    overflow:hidden; /* clip anything that would escape */
  }
  .vector-title{font-weight:700; font-size:15px; margin-bottom:8px; text-align:center;}

  /* SVG: scale to container width, keep aspect, and avoid overflow */
  .vector-svg{
    width:100%;
    height:auto;
    display:block;
    background:linear-gradient(180deg,#fbfeff,#f7fbff);
    border-radius:8px;
    border:1px solid #e6f7ff;
    max-width:100%;
    overflow:hidden;
  }

  /* Axis labels moved to HTML block under SVG to avoid overlapping ticks/markers */
  .axis-labels{display:flex; justify-content:space-between; align-items:center; margin-top:6px; gap:8px; padding:0 6px;}
  .axis-labels .x-label{flex:1; text-align:center; font-weight:600; color:#234;}
  .axis-labels .y-label{width:48px; text-align:left; font-weight:600; color:#234;}
  .vector-legend{font-size:13px; margin-top:8px; color:#444; text-align:center;}
  .axis-selectors{display:flex; gap:8px; justify-content:center; align-items:center; margin-bottom:8px; flex-wrap:wrap;}
  .axis-selectors label{font-size:13px; color:#333;}

  @media (max-width:880px){
    .coef{width:40px;}
    table.chem th, table.chem td{font-size:13px; padding:6px;}
    .formula-box{font-size:15px;}
  }
</style>
</head>
<body>

<div class="chem-wrap">
  <!-- Main Title -->
  <div class="main-title">Chemical Predictor. Details</div>

  <!-- Subtitle -->
  <div class="title">Інтерактивна таблиця — баланс реакції + вектори</div>

  <div class="eq" aria-live="polite">
    <div class="formula-box" id="equation"></div>
    <div style="font-size:13px; color:#444;">(Реагенти зліва — Продукти справа)</div>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", () => {
        
        function drawVectors(){
    drawGrid();

    const innerSize = svgSize - padding * 2;
    const step = innerSize / (coordMax - coordMin);

    const axes = getSelectedAxes();

    // update HTML axis labels (outside SVG) so they never overlap ticks or markers
    const axisLabelX = document.getElementById("axisLabelX");
    const {addDataFuturecoding}